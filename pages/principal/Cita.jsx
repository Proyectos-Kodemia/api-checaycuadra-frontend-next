import React, { useEffect } from 'react'
import Head from 'next/head'
import FooterPage from '../../components/FooterPage'
import NavPage from '../../components/NavPage'
import Appointment from '../../components/appointment/appointment'
import { useRouter } from "next/router";
import Snackbar from '../../components/Notifications/Snackbar'
// Import material component (toast)
// Opcion crear componente de toast para reausarlo

function Cita ({ children, title = 'Checa y Cuadra' }) {
    const router = useRouter();  
    const statusPayment = router.query.collection_status
    console.log(statusPayment)

     // const token = localStorage.getItem('datauser')

    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2MWVjM2I4NjYyZDQ0NzBlMzZmYjAwNDUiLCJyb2xlIjoiY2xpZW50ZSIsImlhdCI6MTY0Mjg3MTcwMX0.o03cOXtbt1svKO3BhwotZ1OEl-SaHH_mbRAydzL4gS0"
      const endpoint = 'http://localhost:8000/metting'
        if(statusPayment){
            const data = {
              userAccount:"61dfb63142eee3cf8d16de99",
              starDate:"2022-01-16T21:30",
              endDateTime:"2022-01-16T22:30",
              title:"consultoria",
              unit_price:"1000",
              quantity:"1",
              statusPayment: statusPayment  
            }
            // post
            const options = {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'token': token
              },
              body: JSON.stringify(data)
            }
            const response = fetch(endpoint, options)
          }


    // useEffect((statusPayment) => {
      
    //   const statusPayment = statusPayment
    //   console.log(statusPayment)
    //   const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2MWVjM2I4NjYyZDQ0NzBlMzZmYjAwNDUiLCJyb2xlIjoiY2xpZW50ZSIsImlhdCI6MTY0Mjg3MTcwMX0.o03cOXtbt1svKO3BhwotZ1OEl-SaHH_mbRAydzL4gS0"
    //   const endpoint = 'http://localhost:8000/mercadopago/checkout'
    //     if(statusPayment){
    //         const data = {
    //           userAccount:"61dfb63142eee3cf8d16de99",
    //           starDate:"2022-01-16T21:30",
    //           endDateTime:"2022-01-16T22:30",
    //           service:"consultoria",
    //           total:"1000",
    //           statusPayment: statusPayment  
    //         }
    //         // post
    //         const options = {
    //           method: 'POST',
    //           headers: {
    //             'Content-Type': 'application/json',
    //             'token': token
    //           },
    //           body: JSON.stringify(data)
    //         }
    //         const response = fetch(endpoint, options)
    //         return response.json()
    //       }
    //     },[])  


  // Probar flujo completo con la autenticacion del usuario
 
  // // local states (toast)
  // const [successToast, setSuccesToast] = useState(False);
  // const [failToast, setFailToast] = useState(False);
  // const [pendeningtToast, setPendeningtToast] = useState(False);

  // comments
  


//   // // if (statusPayment == 'approved')  {
  // //   // deploy succes toast
  // //   setSuccesToast(True);
  // }
  // buscar lo del set time out

  // Construir el post para mandar el pago al back

  // Enviar en el post el token de JWT

  return (
    <>
      <Head>
        <title>{title}</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <NavPage />
      {children}
      <Appointment />
       <Snackbar statusPayment={statusPayment}/> 
      <FooterPage />
    </>
  )
}

export default Cita
